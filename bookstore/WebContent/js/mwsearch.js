$.extend({cookie:function(c,d){if(!d){var b=document.cookie.match(RegExp("(^| )"+c+"=([^;]*)(;|$)"));return b?decodeURIComponent(b[2].replace(/\+/g,"%20")):null}else{document.cookie=c+"="+escape(d)}},removeCookie:function(b){var a=new Date();a.setTime(a.getTime()-1);document.cookie=b+"=;expires="+a.toGMTString()}});function initCityName(a){$.ajax({url:"cityName_"+a+"___.html",cache:true,async:true,dataType:"json",error:function(b,d,c){new SNTouch.Widget.Popbox({title:"切换城市失败！",type:"inner"});return false},success:function(b){$("#cityName").html(b.cityName)}})}var ccf={};var searcher={initialize:function(){var b=this;var a=$.cookie("cityId");if(!a){var c="SNSetCityIdCmd";$.ajax({url:c,cache:false,error:function(d,f,e){b.searchParams.cityId="9173";b.queryData(true)},success:function(d){initCityName(d);b.searchParams.cityId=d;b.queryData(true)}})}else{initCityName(a);b.searchParams.cityId=a;b.queryData(true)}},searchParams:{storeId:sn.storeId,catalogId:sn.catalogId,cityId:"",keyword:sn.keyword,cp:0,ps:sn.pageSize,st:0,set:5,cf:"",iv:"",ci:sn.categoryId},queryData:function(a,c){var b=this;$.ajax({url:"SNMWSearchInterfaceData",data:b.searchParams,type:"post",dataType:"json",async:false,success:function(d){var e;if(d!=null&&d.goodsCount!=null){e=parseInt(d.goodsCount,10)||0}else{e=0}$("#searchKeyword").html(sn.keyword);$("#productAmount").html("("+e+")");if(!e){$("#city_select,#Filter_Order,div.search-list,#touch-pages,#BottomSearchDiv").hide();$("#resultMsg").hide();var f=$("#noResult");f.empty();f.show();$("#loadingMore").hide();f.append('"<span class="a1" id="searchKeyword">'+searcher.searchParams.keyword+'</span>",共找到<span class="a1" id="productAmount">(0)</span>条相关结果');$("#NoResultDiv").show()}else{$("#resultMsg").show();$("#noResult").hide();$("#NoResultDiv").hide();b.utils.parseProductList(d,c);b.utils.initPage({pageCurrent:parseInt(b.searchParams.cp)+1,pageSize:b.searchParams.ps,totalCount:e});if(a){b.utils.constructFilters(d);cateMoreBindClick()}}_searchDataSaPush(e)},error:function(){new SNTouch.Widget.Popbox({title:"搜索为非法字符",type:"inner"})}})},filter:{initialize:function(){var a=this;$("#Cate_Filter").click(function(){$("#filterPage").animate({"margin-left":"-290px","margin-right":"290px"},200).css({overflow:"hidden",height:window.innerHeight});$("#Cate_Choose").animate({right:0},200);$("#Cate_Choose").find(".overtouch").height(window.innerHeight-65);$("div[id^='fv_']").find("a").unbind("click");$("div[id^='fv_']").find("a").bind("click",function(){var f=$(this);var e=f.attr("id");if(e==null||e==undefined){return}var c=false;if(e=="iv"){c=true}var b=e.split(":");var d="";var g="";if(!c){if(b.length==2){d=b[0];g=b[1]}else{return}}if(f.hasClass("cur")){f.removeClass();if(c){delete searcher.searchParams.iv;return}if(ccf[d]==g){delete ccf[d]}}else{f.parent().children("a").removeClass("cur");f.addClass("cur");if(c){searcher.searchParams.iv="1";return}ccf[d]=g}});$("#filter_cancel").unbind("click");$("#filter_cancel").bind("click",filter_hide);$("#popsubmit").unbind("click");$("#popsubmit").bind("click",function(){filter_hide();a.filterSubmit()})})},filterSubmit:function(){(sn.categoryId!=""&&sn.categoryId!=null&&sn.categoryId!=undefined)?searcher.searchParams.ci=sn.categoryId:searcher.searchParams.ci="";searcher.searchParams.cf="";var d="";var b=0;for(var c in ccf){if(typeof ccf[c]==="string"){var a="";if(b>0){a=","+c+":"+ccf[c]}else{a=c+":"+ccf[c]}d+=a}b++}delete searcher.searchParams.cf;if(d!=""){searcher.searchParams.cf=d}searcher.searchParams.cp=0;searcher.queryData()}},sorter:function(){var a=this;$("#Filter_Order").find("li").click(function(){var b=$(this).index();var c=$(this).find("a");if(b==2){if(!$.trim(c[0].className)){c.addClass("down");a.searchParams.st=10}else{if(c.hasClass("down")){c.removeClass("down").addClass("up");a.searchParams.st=9}else{if(c.hasClass("up")){c.removeClass("up").addClass("down");a.searchParams.st=10}}}}else{if(c.hasClass("cur")){return false}switch(b){case 0:a.searchParams.st=8;break;case 1:a.searchParams.st=6;break;case 3:a.searchParams.st=2;break;default:a.searchParams.st=0}}c.addClass("cur").parent().siblings().find("a").removeClass("cur");a.searchParams.cp=0;a.queryData()})},changeCity:function(b,a){$.ajax({url:"SNSetCityIdCmd?newCityId="+b,cache:false,async:false,error:function(c,e,d){new SNTouch.Widget.Popbox({title:"切换城市失败！",type:"inner"});return false},success:function(c){}});searcher.searchParams.cityId=b;searcher.searchParams.cp=0;searcher.searchParams.cf="";searcher.searchParams.iv="";searcher.queryData(true)},utils:{parseProductList:function(a,b){var g;if(b){g=$("#productList")}else{g=$("#productList").empty()}var h=sn.imgDomains;var e=h.split(",");var f=Math.random();var d=parseInt(f*e.length,10);var c=e[d];$.each(a.goods,function(p,v){var u="http://"+sn.domain+sn.context+"/snmwprd_"+sn.storeId+"_"+sn.catalogId+"_"+v.catentryId+"_.html";var q,m,j,t;var k=$('<div class="wbox"></div>');q=$("<li></li>");var w="000000000"+v.partnumber;var o="http://"+c+"/content/catentries/"+w.substring(0,14)+"/"+w+"/"+w+"_ls.jpg";var n=$('<a href="'+u+'"></a>');if(p<8){m=$('<div class="pro-img"><img width="100" height="100" src="'+o+'" alt="'+v.catentdesc+'"/></div>')}else{m=$('<div class="pro-img"><img width="100" height="100" src2="'+o+'" alt="'+v.catentdesc+'"/></div>')}j=$('<div class="pro-info"></div>');t=$('<p class="pro-name">'+subString(v.catentdesc,15,true,false)+"</p>");var s=$('<p class="pro-tip gray6 mt10">'+((v.auxdescription!=null&&typeof(v.auxdescription)!="undefined"&&v.auxdescription!=0)?subString(v.auxdescription,15,true,false):"")+"</p>");var r=$('<p class="mt10"><span class="snPrice" style="font-size:14px;">'+((v.price!=null&&typeof(v.price)!="undefined"&&v.price!=0)?"&yen; "+Number(v.price).toFixed(2):"售罄")+'</span><span class="mr10"> 评价<em class="a1">('+v.countOfarticle+"条)</em></span></p>");j.append(t).append(s).append(r);k.append(m).append(j);var l=$('<span class="arrow"></span>');n.append(k).append(l);q.append(n);g.append(q)})},initPage:function(e){var d=parseInt(e.pageCurrent,10)||1,b=parseInt(e.pageSize,10)||20,a=parseInt(e.totalCount,10)||0,c=parseInt((a-1)/b+1);if(c>0){pageBox=$("#more_load");if(d<c){pageBox.children("div").show();pageBox.children("ul").hide();pageBox.find("a").unbind("click");pageBox.find("a").bind("click",function(){searcher.searchParams.cp=d;pageBox.children("div").hide();pageBox.children("ul").show();searcher.queryData(false,true);pageBox.children("ul").hide()})}else{pageBox.children("div").hide()}}},constructFilters:function(b){var d=$("#Cate_Choose").empty();var c=$('<div class="cate-list-title"><a id="filter_cancel" class="btn-sn-d btn-sn-f" style="float:left;margin:8px 0 0 10px;height:25px;line-height:24px;text-shadow:none;color:#333;" href="###">取消</a>筛选<a class="btn-sn-b btn-sn-f" style="float:right;margin:8px 10px 0 0;height:25px;line-height:24px;color:#333;text-shadow:none;" id="popsubmit" href="#">确定</a></div>');var e=$('<div id="fv_iv" class="type fix" style="border-bottom:1px solid #8A8780;"><a href="#" id="iv">仅显示有货商品<em></em></a></div>');var a=$('<div class="overtouch" style="height:100%;overflow:auto;padding:8px;"></div>');d.append(c);a.append(e);$.each(b.filters,function(j,l){var m=l.values;var h=$('<span class="cate-item fix"><span class="f14 fl">'+l.fieldNameDesc+'</span><span class="fl a-arrow a-right"></span></span>');a.append(h);var g=$('<div class="cate-more fix"></div>');var k=$('<div class="type1 type fix" id="fv_'+j+'" rel="0"></div>');var f=$('<a href="javascript:void(0);" class="cate-more-link">查看更多<i class="a-arrow a-down"></i></a>');$.each(m,function(o,p){var n=$('<a href="###" id="'+l.fieldName+":"+p.value+'">'+p.valueDesc+"<em></em></a>");k.append(n)});g.append(k);g.append(f);a.append(g)});d.append(a)}}};function _searchDataSaPush(k){var j=sn.keyword;var h=(!j||j==null||j=="undefined")?"":j;var e=k;var d="0";var g=null;var c=(!g||g==null||g=="undefined")?"":g;var l=null;var b=(!l||l==null||l=="undefined")?"":l;var f=sn.catalogId;var a=(!f||f==null||f=="undefined")?"":f;var i=[h,e,d,c,b,a];_samap.put("_saSearchDatas",i)}var _samap=new HashMap();function HashMap(){this.keys=new Array();this.data=new Object();this.put=function(a,b){if(this.data[a]==null){this.keys.push(a)}this.data[a]=b};this.get=function(a){return this.data[a]};this.remove=function(a){if(this.get(a)!=null){delete this.data[a]}}}function subString(h,d,j,f){var b=0;var g="";var k=/[^\x00-\xff]/g;var e="";var a=h.replace(k,"**").length;for(var c=0;c<a;c++){e=h.charAt(c).toString();if(e.match(k)!=null){b+=2;if(j){d++}}else{b++}if(b>d){break}g+=e}if(f&&a>d){g+="..."}return g}function openChooseDetail(){$(".cate-item").each(function(){$(this).click(function(){$(this).find(".a-arrow").toggleClass("a-up");$(this).next(".type").toggle()})})}function filter_hide(){$("#filterPage").animate({"margin-left":"0","margin-right":"0"},200).css({overflow:"auto",height:"auto"});$("#Cate_Choose").animate({right:-290},200)}function Productlayload(a){$(window).scroll(function(){$(a).find("img").each(function(){if($(window).scrollTop()>$(this).offset().top-$(window).height()&&$(this).attr("src2")){$(this).attr("src",$(this).attr("src2")).removeAttr("src2")}})})}function cateMoreBindClick(){$(".cate-more").each(function(){var d=$(this),c=d.find(".type"),b=d.find(".cate-more-link"),a=c.find("a").length;a>9?b.show():b.hide();if(b.is(":visible")){b.click(function(){if(c.attr("rel")==0){c.css("max-height",Math.ceil(a/3)*45+10);b.html("收起更多<i class='a-arrow a-up'></i>");c.attr("rel",1)}else{c.css("max-height",135);b.html("查看更多<i class='a-arrow a-down'></i>");c.attr("rel",0)}})}})}function cateMoreBindClick(){$(".cate-more").each(function(){var d=$(this),c=d.find(".type"),b=d.find(".cate-more-link"),a=c.find("a").length;a>9?b.show():b.hide();if(b.is(":visible")){b.click(function(){if(c.attr("rel")==0){c.css("max-height",Math.ceil(a/3)*45+10);b.html("收起更多<i class='a-arrow a-up'></i>");c.attr("rel",1)}else{c.css("max-height",135);b.html("查看更多<i class='a-arrow a-down'></i>");c.attr("rel",0)}})}})}$(function(){SNTouch.init();searcher.filter.initialize();searcher.sorter();SNTouch.Widget.CityChoose({fn:searcher.changeCity});searcher.initialize();var a=$.cookie("wapToEbay");if(!a){$(".client-popup").show()}Productlayload("#productList");$(window).scroll(function(){if($(window).scrollTop()>0){$("#Cate_Pop_box").find(".overtouch").height(window.innerHeight-90);$("#Cate_Choose").height(window.innerHeight)}})});